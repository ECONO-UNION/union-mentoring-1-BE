1. 교착상태란 무엇이고, 어떤 조건들이 갖춰진 경우에 발생하는지 알려주세요.
2. 자원 할당 그래프를 사용해서 Deadlock을 표현해보시오.
3. Deadlock을 다루기 위한 방법 (ignorance, prevention...) 은 이와 같이 여러가지가 있는데 각각의 장단점은 무엇이고 현재 어떤 방법이 가장 많이 쓰이고 있고 왜 그런지 알려주세요.



### 교착상태란

모든 프로세스가 실행을 완료하기 위해 리소스가 필요하지만 리소스는 순차적으로 부여되는 상황

1. 프로세스가 일부 리소스를 요청
2. OS는 사용 가능한 경우 리소스를 부여하지 않으면 프로세스가 기다리도록 한다.
3. 프로세스는 리소스를 사용한 후에 반납한다.

교착 상태는 각 컴퓨터 프로세스가 다른 프로세스에 할당되는 리소스를 기다리는 상황입니다. 

이 상황에서는 필요한 리소스가 다른 리소스가 해제되기를 기다리고 있는 다른 프로세스에 의해 유지되기 때문에 프로세스가 실행되지 않는다.



예시)

![image-20210905025934536](C:\Users\홍동건\AppData\Roaming\Typora\typora-user-images\image-20210905025934536.png)

- P1은 P2에서 사용 중인 R1을 요구
  - P1은 R2 없이는 완료할 수 없으므로 실행을 중지 
- P2는 또한 P3에서 사용 중인 R3을 요구
  - P2는 또한 R3 없이 계속할 수 없기 때문에 실행을 중지합니다. 
- P3는 또한 P1에서 사용 중인 R1을 요구 
  - P3도 실행을 중지합니다. 

-> 진행 중인 프로세스가 없으며 모두 대기 중. 모든 프로세스가 차단되어 컴퓨터가 응답하지 않게 된다.



### 교착상태 VS 기아상태

|      | Deadlock                                                     | Starvation                                                   |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1    | 교착상태는 프로세스가 차단되지 않고 프로세스가 진행되지 않은 상황 | 기아 상태는 우선순위 낮은 프로세스가 차단 되고 우선 순위 높은 프로세스는 진행되는 상황 |
| 2    | 교착 상태는 무한 대기                                        | 기아 상태는 무한대기는 아님                                  |
| 3    | 모든 교착 상태는 기아상태이다.                               | 모든 기아상태가 교착 상태는 아니다                           |
| 4    | 요청한 리소스가 다른 프로세스에 의해 차단되었다.             | 요청된 리소스는 우선 순위 높은 프로세스에서 계속 사용된다.   |
| 5    | 상호 배제, 보유 및 대기, 비선점, 순환이 동시에 발생할 대 발생 | 컨트롤할수 없는 우선순위와 자원 관리로 인해 발생             |



### 교착 상태에 필요한 조건

#### 1, Mutual exclusion

리소스는 상호 배타적인 방식으로만 공유할 수 있습니다. 두 프로세스가 동시에 동일한 리소스를 사용할 수 없는 경우를 의미합니다.

#### 2. Hold and Wait

프로세스는 다른 리소스를 동시에 보유하면서 일부 리소스를 기다립니다.

#### 3. No preemption

한 번 예약된 프로세스는 완료될 때까지 실행됩니다. 그 동안 스케줄러는 다른 프로세스를 예약할 수 없습니다.

#### 4. Circular wait

모든 프로세스는 순환 방식으로 자원을 기다리고 있어야 마지막 프로세스가 첫 번째 프로세스가 보유하고 있는 자원을 기다리고 있습니다.





### 교착 상태를 처리하기 위한 전략

#### 1. Deadlock Ignorance

교착 상태 무시하는 것은 모든 메커니즘 중에서 가장 널리 사용되는 접근 방식이다. 

이 접근 방식에서 운영 체제는 교착 상태가 발생하지 않는다고 가정하고 단순히 교착 상태를 무시하는 것이다. 

이 접근 방식은 사용자가 검색 및 기타 모든 일반적인 용도로만 시스템을 사용하는 단일 최종 사용자 시스템에 가장 적합하다.

정확성과 성능 사이에는 항상 절충점이 있습니다. 

Windows 및 Linux와 같은 운영 체제는 주로 성능에 중점을 둡니다. 

그러나 교착 상태가 100번 중 1번 발생하면 항상 교착 상태 처리 메커니즘을 사용하면 시스템의 성능이 저하되므로 항상 교착 상태 처리 메커니즘을 사용할 필요가 없고 교착상태기 발생한 경우 컴퓨터를 다시 시작하기만 하면 된다. (윈도우, 리눅스)



#### 2. Deadlock prevention

교착 상태는 상호 배제, 보유 및 대기, 비선점, 순환 대기가 동시에 유지되는 경우에만 발생한다.

언제든지 네 가지 조건 중 하나를 위반할 수 있는 경우 시스템에서 교착상태가 발생할 수 없다.

네 가지 필수 조건 중 하나를 위반할 수 있고 함께 발생하지 않도록 하면 교착 상태를 방지할 수 있다.

- 상호 배제

상호 배제 방식으로 동작하는 리소스를 위반할 수 있으면 교착상태를 방지 할 수 있다.

프린터와 같은 장치의 경우 스풀링이 작동할 수 있다.

각 프로세스의 작업을 저장해놓은 프린터와 관련된 메모리가 있는데 프린터는 이 메모리에 저장된 모든 작업을 수집하고 각 작업을 인쇄하게 한다.

이 매커니즘을 사용하면 프로세스가 프린터를 기다릴 필요가 없으며 수행하던 작업을 계속할 수 있다.

그러나 스풀링은 상호배제를 위반하는 방식이 될 수 있지만 두가지 문제가 존재한다.

1. 모든 리소스에 적용할 수 없다.
2. 일정 시간이 지나면 해당 스풀에 공간을 확보하기 위해 프로세스 간에 경쟁 조건이 발생할 수 있다.

성능에 심각한 문제가 발생할 수 있기 때문에 동시에 둘 이상의 프로세스에서 리소스를 사용하도록 강제할 수 없다. 따라서 실질적으로 프로세스에 대한 상호 배제를 위반할 수 없다.



- 보유 및 대기

프로세스가 리소스를 보유하지 않거나 기다리지 않는 메커니즘을 찾아야 한다.

즉 실행이 시작되기 전에 프로세스에 필욯나 모든 리소스가 할당되어야 한다. 프로세스는 실행이 시작되면 리소스를 기다리지 않게 한다.

프로세스가 초기에 모든 자원을 선언하는 경우 실질적으로 구현할 수 있다. 

그러나 이것은 매우 실용적으로 들리지만 프로세스가 초기에 필요한 리소스를 결정할 수 없기 때문에 컴퓨터 시스템에서는 수행할 수 없다.

프로세스는 CPU가 실행하는 일련의 명령이므로 여러 번 여러 리소스를 요구할 수 있다. 

1. 사실상 불가능
2. 일부 프로세스가 리소스를 매우 오랫동안 보유할 수 있기 때문에 기아 상태가 될 가능성이 높아짐



- 비선점

교착 상태는 프로세스가 시작되면 멈출 수 없기 때문에 발생.

그러나 교착 상태를 유발하는 프로세스에서 리소스를 제거하면 교착 상태를 방지할 수 있다.

프로세스에서 사용 중인 리소스를 제거하면 지금까지 수행한 모든 작업이 일관되지 않을 수 있기 때문에 좋지 않은 방식이다



- 순환 대기

순환 대기를 위반하기 위해 각 리소스에 우선 순위 번호를 할당후 프로세스는 우선 순위가 낮은 리소스를 요청할 수 없게 한다. 

이렇게 하면 단일 프로세스가 다른 프로세스에서 사용 중인 리소스를 요청할 수 없으며 사이클이 형성되지 않습니다.



-> 순환 대기를 어기는 방식이 실질적으로 구현할 수 있는 방법이다.



#### 3. Deadlock avoidance

데드락이 발생할 가능성이 있으면 피해가도록 하는 방법

회피 방법 이용하려면 사전 정보가 필요. 사전 정보가 뭐냐면, 각 프로세스가 어떤 자원을 내가 최대한 몇개 쓸거다라고 알려주는 것이다.

시스템은 사전 정보를 이용해서 현재 시스템 상태를 계속 주시 해서 환형대기에 빠지지 않도록 피해가게 만든다.

시스템의 현재 상태는 현재 1)우리가 사용할 수 있는 자원의 개수와 2)각 자원이 어떤 프로세스에게 몇개 할당되있냐 할당 개수들과 3)각 프로세스가 자원을 최대 몇개를 요구하는가 3가지 정보를 가지고 시스템 현재 상태를 기술할 수 있다.

회피 방법으로 운영 체제가 수행하는 모든 단계에서 시스템이 안전한 상태인지 안전하지 않은 상태인지 확인한다.

시스템이 안전한 상태가 될 때 까지 프로세스가 계속 되게 하고 시스템이 안전하지 않은 상태로 이동하면 OS는 한 단계를 역추적 한다.

OS는 할당이 시스템에서 교착 상태를 일으키지 않도록 각 할당을 검토한다.

교착 상태를 피하기 위해 프로세스는 프로세스가 실행을 완료하기 위해 요청할 수 있는 최대 리소스 수를 OS에 알려야 하는데 가장 유용한 접근 방식은 프로세스가 필요할 수 있는 각 유형의 최대 리소스 수를 선언하는 방식이다. 

안전 상태 : 현재 시스템에 있는 모든 프로세스가 끝낼 수 있는 순서가 하나라도 잇으면 시스템이 안전한 상태

안전하지 않은 상태 : 모든 프로세스가 끝낼 수 있는 순서가 하나라도 없는 경우

-> 리소스에 대한 요청이 있을 대 결과 상태가 안전 상태인 경웅에만 요청이 승인되어야 한다.



#### 4. Deadlock detection and recovery

프로세스가 교착 상태에 빠지도록  한 다음 시스템에서 교착 상태가 발생하는지 여부를 주기적으로 확인한다.

교착 상태가 발생하면 시스템에 일부 복구 방법을 적용한다.

따라서 시스템은 교착 상태가 반드시 발생한다고 간주. 

교착 상태를 제거하기 위해 OS는 교착 상태가 있는지 시스템을 주기적으로 확인하고 교착 상태를 발견한 경우 OS는 일부 복구 기술을 사용하여 시스템을 복구한다.

OS의 주요 작업은 교착 상태를 감지하는 것이고 자원 할당 그래프로 감지할 수 있다.

교착 상태에서 시스템을 복구하기 위해 OS는 리소스 또는 프로세스를 고려한다.

- 리소스

리소스 선점 - 자원 중 하나를 빼앗아 실행을 완료하고 이 자원을 더 빨리 해제할 것이라는 기대와 함께 다른 프로세스에 이를 제공 (사실상 불가능)

안전한 상태로 롤백 - 시스템은 다양한 상태를 거쳐 교착 상태가 된다. 운영 체제는 시스템을 이전 안전 상태로 롤백시키기 위해 OS는 모든 상태에서 체크 포인팅을 구현해야 한다.

- 프로세스

프로세스 종료 - 어떤 프로세스르를 종료시킬 것인가, 일반적으로 가장 적은 양의 작업을 수행한 프로세스

모든 프로세스 종료 - 심각해질 때 모두 종료



### 자원 할당 그래프

- 프로세스와 그 프로세스가 사용하는 자원의 관계를 도식화한 것을 자원할당 그래프라고 한다.
  - 이 그래프의 사이클 유무에 따라 현재 상태에서 데드락의 유무를 확인한다.
- 동그라미는 프로세스, 네모는 자원을 나타낸다. 네모속의 점은 자원의 인스턴스를 의미한다.
- 프로세스 -> 자원 : 프로세스가 해당 자원을 요청하는 것을 의미한다.
- 자원 -> 프로세스 : 프로세스가 해당 자원을 소유하는 것을 의미한다.

<img src="C:\Users\홍동건\AppData\Roaming\Typora\typora-user-images\image-20210905105017170.png" alt="image-20210905105017170" style="zoom:50%;" />



->자원 할당 그래프에 Cycle이 존재 하지 않으면 DeadLock이 아니다.

-> 자원 할당 그래프에 Cycle이 존재 한다면 DeadLock일 수도, 아닐수도 있다. 



![image-20210905105202238](C:\Users\홍동건\AppData\Roaming\Typora\typora-user-images\image-20210905105202238.png)

왼쪽 : 데드락

오른쪽 : P2가 자원 R1을 반납합면, P1은 R1을 할당 받아 작업을 수행할 수 있다. 마찬가지로 P4가 자원 R2를 반납하면 P3가 R2를 할당받아 작업을 수행할 수 있다. 데드락x  